<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Promise知识点详解 | 随心博客</title>
    <meta name="description" content="李岩">
    <link rel="icon" href="/meta.png">
    
    <link rel="preload" href="/assets/css/0.styles.6496ff17.css" as="style"><link rel="preload" href="/assets/js/app.5b8afd62.js" as="script"><link rel="preload" href="/assets/js/2.26f2bd2e.js" as="script"><link rel="preload" href="/assets/js/127.e9ad96e9.js" as="script"><link rel="prefetch" href="/assets/js/10.705d4443.js"><link rel="prefetch" href="/assets/js/100.d063b5b4.js"><link rel="prefetch" href="/assets/js/101.4582c35b.js"><link rel="prefetch" href="/assets/js/102.232e0dde.js"><link rel="prefetch" href="/assets/js/103.c8d25557.js"><link rel="prefetch" href="/assets/js/104.36ccd472.js"><link rel="prefetch" href="/assets/js/105.50bf76d7.js"><link rel="prefetch" href="/assets/js/106.5d2f8ad4.js"><link rel="prefetch" href="/assets/js/107.3fcec35f.js"><link rel="prefetch" href="/assets/js/108.4d2f14c2.js"><link rel="prefetch" href="/assets/js/109.b689b8f3.js"><link rel="prefetch" href="/assets/js/11.bdbd9766.js"><link rel="prefetch" href="/assets/js/110.3b54110b.js"><link rel="prefetch" href="/assets/js/111.7c57f5e1.js"><link rel="prefetch" href="/assets/js/112.ce99e9a0.js"><link rel="prefetch" href="/assets/js/113.f2ed2100.js"><link rel="prefetch" href="/assets/js/114.12ffa65c.js"><link rel="prefetch" href="/assets/js/115.2de143e5.js"><link rel="prefetch" href="/assets/js/116.f409b207.js"><link rel="prefetch" href="/assets/js/117.06bb8923.js"><link rel="prefetch" href="/assets/js/118.886bb150.js"><link rel="prefetch" href="/assets/js/119.18437523.js"><link rel="prefetch" href="/assets/js/12.359920d0.js"><link rel="prefetch" href="/assets/js/120.7c70b797.js"><link rel="prefetch" href="/assets/js/121.21138d68.js"><link rel="prefetch" href="/assets/js/122.d059d7c0.js"><link rel="prefetch" href="/assets/js/123.b5bd9d2b.js"><link rel="prefetch" href="/assets/js/124.49bccc4f.js"><link rel="prefetch" href="/assets/js/125.f6553933.js"><link rel="prefetch" href="/assets/js/126.6b104f67.js"><link rel="prefetch" href="/assets/js/128.392cd42f.js"><link rel="prefetch" href="/assets/js/129.65bb4b10.js"><link rel="prefetch" href="/assets/js/13.c251bb6d.js"><link rel="prefetch" href="/assets/js/130.9c00f55c.js"><link rel="prefetch" href="/assets/js/131.b89396ae.js"><link rel="prefetch" href="/assets/js/132.3664b8e1.js"><link rel="prefetch" href="/assets/js/133.9af49e12.js"><link rel="prefetch" href="/assets/js/134.5c9f222c.js"><link rel="prefetch" href="/assets/js/135.b7337869.js"><link rel="prefetch" href="/assets/js/136.8d465332.js"><link rel="prefetch" href="/assets/js/137.9bfa6405.js"><link rel="prefetch" href="/assets/js/138.3abb7d24.js"><link rel="prefetch" href="/assets/js/139.9b2bc9ca.js"><link rel="prefetch" href="/assets/js/14.6d6eacd3.js"><link rel="prefetch" href="/assets/js/140.3e4cf00c.js"><link rel="prefetch" href="/assets/js/141.4cb7870c.js"><link rel="prefetch" href="/assets/js/142.35045f36.js"><link rel="prefetch" href="/assets/js/143.ef8b52a4.js"><link rel="prefetch" href="/assets/js/144.5382b476.js"><link rel="prefetch" href="/assets/js/145.d1183138.js"><link rel="prefetch" href="/assets/js/146.18ed2627.js"><link rel="prefetch" href="/assets/js/147.8a109312.js"><link rel="prefetch" href="/assets/js/148.4ff80924.js"><link rel="prefetch" href="/assets/js/149.5458e40a.js"><link rel="prefetch" href="/assets/js/15.969df2fd.js"><link rel="prefetch" href="/assets/js/150.38e86593.js"><link rel="prefetch" href="/assets/js/151.e47f84f3.js"><link rel="prefetch" href="/assets/js/152.3daba2a5.js"><link rel="prefetch" href="/assets/js/153.2e69bf61.js"><link rel="prefetch" href="/assets/js/154.e83aa494.js"><link rel="prefetch" href="/assets/js/155.eff3fa36.js"><link rel="prefetch" href="/assets/js/156.68ba02a6.js"><link rel="prefetch" href="/assets/js/157.5fc0fd6c.js"><link rel="prefetch" href="/assets/js/158.a2f8643d.js"><link rel="prefetch" href="/assets/js/159.f061fc3b.js"><link rel="prefetch" href="/assets/js/16.93af31ac.js"><link rel="prefetch" href="/assets/js/160.922d9b61.js"><link rel="prefetch" href="/assets/js/161.10bafeb5.js"><link rel="prefetch" href="/assets/js/162.c8d2bff0.js"><link rel="prefetch" href="/assets/js/163.21fab3da.js"><link rel="prefetch" href="/assets/js/164.2f9a4c0a.js"><link rel="prefetch" href="/assets/js/165.a5c88488.js"><link rel="prefetch" href="/assets/js/166.df3a3395.js"><link rel="prefetch" href="/assets/js/167.a7b331c4.js"><link rel="prefetch" href="/assets/js/168.2ffced34.js"><link rel="prefetch" href="/assets/js/169.d9cbe4f3.js"><link rel="prefetch" href="/assets/js/17.4fe12c04.js"><link rel="prefetch" href="/assets/js/170.6d7ec79e.js"><link rel="prefetch" href="/assets/js/171.7c36dcde.js"><link rel="prefetch" href="/assets/js/172.c94761c8.js"><link rel="prefetch" href="/assets/js/173.52319acf.js"><link rel="prefetch" href="/assets/js/174.054ad281.js"><link rel="prefetch" href="/assets/js/175.f9e66221.js"><link rel="prefetch" href="/assets/js/176.5643433a.js"><link rel="prefetch" href="/assets/js/177.8030aa35.js"><link rel="prefetch" href="/assets/js/178.783841fc.js"><link rel="prefetch" href="/assets/js/179.31e092d5.js"><link rel="prefetch" href="/assets/js/18.8fde6dee.js"><link rel="prefetch" href="/assets/js/180.34d5c297.js"><link rel="prefetch" href="/assets/js/181.a836d6d7.js"><link rel="prefetch" href="/assets/js/182.0fb1942e.js"><link rel="prefetch" href="/assets/js/183.f786010e.js"><link rel="prefetch" href="/assets/js/184.b49e60aa.js"><link rel="prefetch" href="/assets/js/185.e9898f7c.js"><link rel="prefetch" href="/assets/js/186.6e4b6b88.js"><link rel="prefetch" href="/assets/js/187.ab3a7e16.js"><link rel="prefetch" href="/assets/js/188.77525743.js"><link rel="prefetch" href="/assets/js/189.df563c11.js"><link rel="prefetch" href="/assets/js/19.4eee66e8.js"><link rel="prefetch" href="/assets/js/190.60403d42.js"><link rel="prefetch" href="/assets/js/191.b1792b43.js"><link rel="prefetch" href="/assets/js/192.32a6cb54.js"><link rel="prefetch" href="/assets/js/193.3242cf83.js"><link rel="prefetch" href="/assets/js/194.655d1a6e.js"><link rel="prefetch" href="/assets/js/195.63e31ee2.js"><link rel="prefetch" href="/assets/js/196.7fa6aae5.js"><link rel="prefetch" href="/assets/js/197.a4b27ff7.js"><link rel="prefetch" href="/assets/js/198.d44c5a71.js"><link rel="prefetch" href="/assets/js/199.003a1723.js"><link rel="prefetch" href="/assets/js/20.ce08baab.js"><link rel="prefetch" href="/assets/js/200.543be16c.js"><link rel="prefetch" href="/assets/js/201.95f8066b.js"><link rel="prefetch" href="/assets/js/202.c9f68cca.js"><link rel="prefetch" href="/assets/js/203.89666bca.js"><link rel="prefetch" href="/assets/js/204.9c7264fe.js"><link rel="prefetch" href="/assets/js/205.9b111e8d.js"><link rel="prefetch" href="/assets/js/206.3e100a5d.js"><link rel="prefetch" href="/assets/js/207.181ad826.js"><link rel="prefetch" href="/assets/js/208.b9327be3.js"><link rel="prefetch" href="/assets/js/209.4deec58b.js"><link rel="prefetch" href="/assets/js/21.0b01c02a.js"><link rel="prefetch" href="/assets/js/210.aa5e4af7.js"><link rel="prefetch" href="/assets/js/211.f0ff0880.js"><link rel="prefetch" href="/assets/js/22.7a67a9a4.js"><link rel="prefetch" href="/assets/js/23.efb9856a.js"><link rel="prefetch" href="/assets/js/24.55302dbf.js"><link rel="prefetch" href="/assets/js/25.7061396b.js"><link rel="prefetch" href="/assets/js/26.c3845e4b.js"><link rel="prefetch" href="/assets/js/27.e0215617.js"><link rel="prefetch" href="/assets/js/28.5e671074.js"><link rel="prefetch" href="/assets/js/29.427adfaa.js"><link rel="prefetch" href="/assets/js/3.9cd2409c.js"><link rel="prefetch" href="/assets/js/30.e505a4f2.js"><link rel="prefetch" href="/assets/js/31.3d08e3fb.js"><link rel="prefetch" href="/assets/js/32.a28d0314.js"><link rel="prefetch" href="/assets/js/33.3e43944a.js"><link rel="prefetch" href="/assets/js/34.67243606.js"><link rel="prefetch" href="/assets/js/35.2df45cfb.js"><link rel="prefetch" href="/assets/js/36.e34a4764.js"><link rel="prefetch" href="/assets/js/37.ee1de8ec.js"><link rel="prefetch" href="/assets/js/38.7b8e81dd.js"><link rel="prefetch" href="/assets/js/39.3277fe3c.js"><link rel="prefetch" href="/assets/js/4.ec95372a.js"><link rel="prefetch" href="/assets/js/40.f7c77801.js"><link rel="prefetch" href="/assets/js/41.3647078b.js"><link rel="prefetch" href="/assets/js/42.57c713f6.js"><link rel="prefetch" href="/assets/js/43.1e4e1762.js"><link rel="prefetch" href="/assets/js/44.615425a7.js"><link rel="prefetch" href="/assets/js/45.4338d65b.js"><link rel="prefetch" href="/assets/js/46.34589809.js"><link rel="prefetch" href="/assets/js/47.d980cc22.js"><link rel="prefetch" href="/assets/js/48.615af50d.js"><link rel="prefetch" href="/assets/js/49.878ee0dc.js"><link rel="prefetch" href="/assets/js/5.e730c6e3.js"><link rel="prefetch" href="/assets/js/50.e687b809.js"><link rel="prefetch" href="/assets/js/51.80b24163.js"><link rel="prefetch" href="/assets/js/52.6fcab5f9.js"><link rel="prefetch" href="/assets/js/53.e98a99e4.js"><link rel="prefetch" href="/assets/js/54.f7ba75ee.js"><link rel="prefetch" href="/assets/js/55.b96dc8c0.js"><link rel="prefetch" href="/assets/js/56.30684913.js"><link rel="prefetch" href="/assets/js/57.2b10f070.js"><link rel="prefetch" href="/assets/js/58.dde78282.js"><link rel="prefetch" href="/assets/js/59.f2748667.js"><link rel="prefetch" href="/assets/js/6.4f4c8e1f.js"><link rel="prefetch" href="/assets/js/60.dee2d37e.js"><link rel="prefetch" href="/assets/js/61.5536e84b.js"><link rel="prefetch" href="/assets/js/62.926b1691.js"><link rel="prefetch" href="/assets/js/63.11468357.js"><link rel="prefetch" href="/assets/js/64.880781fa.js"><link rel="prefetch" href="/assets/js/65.13b9fbb9.js"><link rel="prefetch" href="/assets/js/66.13c0bc5d.js"><link rel="prefetch" href="/assets/js/67.37437fae.js"><link rel="prefetch" href="/assets/js/68.72d1cc98.js"><link rel="prefetch" href="/assets/js/69.abb5099c.js"><link rel="prefetch" href="/assets/js/7.29b3cfae.js"><link rel="prefetch" href="/assets/js/70.531c0939.js"><link rel="prefetch" href="/assets/js/71.47eb68af.js"><link rel="prefetch" href="/assets/js/72.d7436adb.js"><link rel="prefetch" href="/assets/js/73.7a1ab39d.js"><link rel="prefetch" href="/assets/js/74.0886c80e.js"><link rel="prefetch" href="/assets/js/75.8e981c11.js"><link rel="prefetch" href="/assets/js/76.257691fd.js"><link rel="prefetch" href="/assets/js/77.c1e3885c.js"><link rel="prefetch" href="/assets/js/78.8c8f4177.js"><link rel="prefetch" href="/assets/js/79.8119d41e.js"><link rel="prefetch" href="/assets/js/8.315d1a33.js"><link rel="prefetch" href="/assets/js/80.66a0b271.js"><link rel="prefetch" href="/assets/js/81.d6f3f6c3.js"><link rel="prefetch" href="/assets/js/82.681fa4d8.js"><link rel="prefetch" href="/assets/js/83.d3484106.js"><link rel="prefetch" href="/assets/js/84.a08cfc20.js"><link rel="prefetch" href="/assets/js/85.361f048b.js"><link rel="prefetch" href="/assets/js/86.3d658719.js"><link rel="prefetch" href="/assets/js/87.b00d7274.js"><link rel="prefetch" href="/assets/js/88.211ca64b.js"><link rel="prefetch" href="/assets/js/89.191e9fa3.js"><link rel="prefetch" href="/assets/js/9.20347705.js"><link rel="prefetch" href="/assets/js/90.f03b34b1.js"><link rel="prefetch" href="/assets/js/91.1b460aa9.js"><link rel="prefetch" href="/assets/js/92.344a79de.js"><link rel="prefetch" href="/assets/js/93.aa2e8b9e.js"><link rel="prefetch" href="/assets/js/94.cd3039b8.js"><link rel="prefetch" href="/assets/js/95.ef18c157.js"><link rel="prefetch" href="/assets/js/96.9ed8f30c.js"><link rel="prefetch" href="/assets/js/97.61a118ec.js"><link rel="prefetch" href="/assets/js/98.e276de0c.js"><link rel="prefetch" href="/assets/js/99.9e6e23b8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6496ff17.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">随心博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://github.com/strugglebook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/construct/" class="nav-link">构建网站</a></div><div class="nav-item"><a href="/Flutter/" class="nav-link">Flutter</a></div><div class="nav-item"><a href="/Algorithm/" class="nav-link">算法世界</a></div><div class="nav-item"><a href="/MongDB/" class="nav-link">MongDB</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小程序" class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/WeiXin/" class="nav-link">微信小程序入门和云开发</a></li><li class="dropdown-item"><!----> <a href="/WeiXin-Combat/" class="nav-link">微信小程序云开发实战</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Development-Tool/" class="nav-link">开发工具</a></li><li class="dropdown-item"><!----> <a href="/javaGrammar/" class="nav-link">java语法</a></li><li class="dropdown-item"><!----> <a href="/java-Database/" class="nav-link">java链接数据库</a></li><li class="dropdown-item"><!----> <a href="/javaWeb/" class="nav-link">javaWeb</a></li><li class="dropdown-item"><!----> <a href="/java-Frame/" class="nav-link">java搭建ssm框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具系列" class="dropdown-title"><span class="title">工具系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Jest/" class="nav-link">Jest</a></li><li class="dropdown-item"><!----> <a href="/Webpack/" class="nav-link">Webpack</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="全栈" class="dropdown-title"><span class="title">全栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Full-Stack-FriendCircle/" class="nav-link">朋友圈</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node" class="dropdown-title"><span class="title">node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" class="nav-link router-link-active">node入门</a></li><li class="dropdown-item"><!----> <a href="/node-RESTful/" class="nav-link">node与RESTful</a></li><li class="dropdown-item"><!----> <a href="/node-GraphQL/" class="nav-link">node与GraphQL</a></li><li class="dropdown-item"><!----> <a href="/node-BFF/" class="nav-link">node与BFF</a></li><li class="dropdown-item"><!----> <a href="/node-blog/" class="nav-link">node博客后台</a></li><li class="dropdown-item"><!----> <a href="/node-weibo/" class="nav-link">node实战微博</a></li><li class="dropdown-item"><!----> <a href="/node-microService/" class="nav-link">node微服务</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TS系列" class="dropdown-title"><span class="title">TS系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/typescript/" class="nav-link">TypeScript入门</a></li><li class="dropdown-item"><!----> <a href="/typescript-axios-font/" class="nav-link">TS重构axios前置学习</a></li><li class="dropdown-item"><!----> <a href="/typescript-axios/" class="nav-link">TS重构axios项目开发</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="react" class="dropdown-title"><span class="title">react</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react-jinjie/" class="nav-link">React实战进阶</a></li><li class="dropdown-item"><!----> <a href="/react-junior/" class="nav-link">React开发简书项目</a></li><li class="dropdown-item"><!----> <a href="/react-dazhong/" class="nav-link">React实战大众点评WebApp</a></li><li class="dropdown-item"><!----> <a href="/react-quna/" class="nav-link">React去哪儿网火车票PWA</a></li><li class="dropdown-item"><!----> <a href="/react-ssr/" class="nav-link">React服务器渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/react-next/" class="nav-link">React+Next.js+Koa2</a></li><li class="dropdown-item"><!----> <a href="/react-yuanma/" class="nav-link">React源码深度解析</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-shizhan/" class="nav-link">Vue开发实战</a></li><li class="dropdown-item"><!----> <a href="/vue-quna/" class="nav-link">Vue2.5开发去哪儿网App</a></li><li class="dropdown-item"><!----> <a href="/vue-shagncheng/" class="nav-link">Get全栈技能打造商城系统</a></li><li class="dropdown-item"><!----> <a href="/vue-dushu/" class="nav-link">Vue 实战商业级读书WebApp</a></li><li class="dropdown-item"><!----> <a href="/vue-ssr/" class="nav-link">Vue服务端渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/vue-nuxt/" class="nav-link">Vue全家桶+SSR+Koa2</a></li><li class="dropdown-item"><!----> <a href="/vue-yuanma/" class="nav-link">Vue.js源码全方位深入解析</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端系列" class="dropdown-title"><span class="title">前端系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end/" class="nav-link">前端架构</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://github.com/strugglebook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/construct/" class="nav-link">构建网站</a></div><div class="nav-item"><a href="/Flutter/" class="nav-link">Flutter</a></div><div class="nav-item"><a href="/Algorithm/" class="nav-link">算法世界</a></div><div class="nav-item"><a href="/MongDB/" class="nav-link">MongDB</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小程序" class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/WeiXin/" class="nav-link">微信小程序入门和云开发</a></li><li class="dropdown-item"><!----> <a href="/WeiXin-Combat/" class="nav-link">微信小程序云开发实战</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Development-Tool/" class="nav-link">开发工具</a></li><li class="dropdown-item"><!----> <a href="/javaGrammar/" class="nav-link">java语法</a></li><li class="dropdown-item"><!----> <a href="/java-Database/" class="nav-link">java链接数据库</a></li><li class="dropdown-item"><!----> <a href="/javaWeb/" class="nav-link">javaWeb</a></li><li class="dropdown-item"><!----> <a href="/java-Frame/" class="nav-link">java搭建ssm框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具系列" class="dropdown-title"><span class="title">工具系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Jest/" class="nav-link">Jest</a></li><li class="dropdown-item"><!----> <a href="/Webpack/" class="nav-link">Webpack</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="全栈" class="dropdown-title"><span class="title">全栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Full-Stack-FriendCircle/" class="nav-link">朋友圈</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="node" class="dropdown-title"><span class="title">node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/" class="nav-link router-link-active">node入门</a></li><li class="dropdown-item"><!----> <a href="/node-RESTful/" class="nav-link">node与RESTful</a></li><li class="dropdown-item"><!----> <a href="/node-GraphQL/" class="nav-link">node与GraphQL</a></li><li class="dropdown-item"><!----> <a href="/node-BFF/" class="nav-link">node与BFF</a></li><li class="dropdown-item"><!----> <a href="/node-blog/" class="nav-link">node博客后台</a></li><li class="dropdown-item"><!----> <a href="/node-weibo/" class="nav-link">node实战微博</a></li><li class="dropdown-item"><!----> <a href="/node-microService/" class="nav-link">node微服务</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="TS系列" class="dropdown-title"><span class="title">TS系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/typescript/" class="nav-link">TypeScript入门</a></li><li class="dropdown-item"><!----> <a href="/typescript-axios-font/" class="nav-link">TS重构axios前置学习</a></li><li class="dropdown-item"><!----> <a href="/typescript-axios/" class="nav-link">TS重构axios项目开发</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="react" class="dropdown-title"><span class="title">react</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react-jinjie/" class="nav-link">React实战进阶</a></li><li class="dropdown-item"><!----> <a href="/react-junior/" class="nav-link">React开发简书项目</a></li><li class="dropdown-item"><!----> <a href="/react-dazhong/" class="nav-link">React实战大众点评WebApp</a></li><li class="dropdown-item"><!----> <a href="/react-quna/" class="nav-link">React去哪儿网火车票PWA</a></li><li class="dropdown-item"><!----> <a href="/react-ssr/" class="nav-link">React服务器渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/react-next/" class="nav-link">React+Next.js+Koa2</a></li><li class="dropdown-item"><!----> <a href="/react-yuanma/" class="nav-link">React源码深度解析</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-shizhan/" class="nav-link">Vue开发实战</a></li><li class="dropdown-item"><!----> <a href="/vue-quna/" class="nav-link">Vue2.5开发去哪儿网App</a></li><li class="dropdown-item"><!----> <a href="/vue-shagncheng/" class="nav-link">Get全栈技能打造商城系统</a></li><li class="dropdown-item"><!----> <a href="/vue-dushu/" class="nav-link">Vue 实战商业级读书WebApp</a></li><li class="dropdown-item"><!----> <a href="/vue-ssr/" class="nav-link">Vue服务端渲染原理解析</a></li><li class="dropdown-item"><!----> <a href="/vue-nuxt/" class="nav-link">Vue全家桶+SSR+Koa2</a></li><li class="dropdown-item"><!----> <a href="/vue-yuanma/" class="nav-link">Vue.js源码全方位深入解析</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端系列" class="dropdown-title"><span class="title">前端系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Front-end/" class="nav-link">前端架构</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/node/" class="sidebar-link">node要精通</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>本质与机制</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>模块和核心</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>异步和流程</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/node/three_asyncControl.html" class="sidebar-link">异步写法和流程控制</a></li><li><a href="/node/three_asyncPreliminary.html" class="sidebar-link">异步流程初探</a></li><li><a href="/node/three_asyncDepth_promise1.html" class="active sidebar-link">Promise知识点详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#六大方法" class="sidebar-link">六大方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#_1-promise-resolve" class="sidebar-link">1. Promise.resolve</a></li><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#_2-promise-reject" class="sidebar-link">2. Promise.reject</a></li><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#_3-promise-then" class="sidebar-link">3. Promise.then</a></li><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#_4-promise-catch" class="sidebar-link">4. Promise.catch</a></li><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#_5-promise-all" class="sidebar-link">5. Promise.all</a></li><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#_6-promise-race" class="sidebar-link">6. Promise.race</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#错误捕获" class="sidebar-link">错误捕获</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#_1-使用reject而不是throw" class="sidebar-link">1. 使用reject而不是throw</a></li><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#_2-在then中进行reject" class="sidebar-link">2. 在then中进行reject</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/three_asyncDepth_promise1.html#返回值" class="sidebar-link">返回值</a></li></ul></li><li><a href="/node/three_asyncDepth_promise2.html" class="sidebar-link">Promise实现详解</a></li><li><a href="/node/three_asyncDepth_await1.html" class="sidebar-link">async-await知识点详解</a></li><li><a href="/node/three_asyncDepth_await2.html" class="sidebar-link">async-await最佳实践</a></li><li><a href="/node/three_asyncDepth_await3.html" class="sidebar-link">async-await更快的优化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>测试和工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>传输和协议</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="promise知识点详解"><a href="#promise知识点详解" class="header-anchor">#</a> Promise知识点详解</h1> <h2 id="六大方法"><a href="#六大方法" class="header-anchor">#</a> 六大方法</h2> <h3 id="_1-promise-resolve"><a href="#_1-promise-resolve" class="header-anchor">#</a> 1. Promise.resolve</h3> <p>静态方法<code>Promise.resolve(value)</code>可以认为是<code>new Promise()</code>方法的快捷方式,比如<code>Promise.resolve(42)</code>可以认为是以下代码的语法糖:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这个静态方法会让<code>Promise</code>对象立即进入确定（即resolved）状态，并将42传递给后面<code>then</code>里所指定的<code>onFulfilled</code>函数。作为<code>new Promise()</code>的快捷方式，在进行<code>Promise</code>对象的初始化或者编写测试代码的时候都非常方便。</p> <p>简单总结一下<code>Promise.resolve</code>方法的话，<font color="#CC99CD">它的作用就是将传递给它的参数填充（Fulfilled）到promise对象后并返回这个promise对象</font>。</p> <h3 id="_2-promise-reject"><a href="#_2-promise-reject" class="header-anchor">#</a> 2. Promise.reject</h3> <p><code>Promise.reject(error)</code>是和<code>Promise.resolve(value)</code>类似的静态方法，是<code>new Promise()</code>方法的快捷方式。比如<code>Promise.reject(new Error(&quot;出错了&quot;))</code>就是下面代码的语法糖形式:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;出错了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>简单总结一下<code>Promise.reject</code>方法的话：<font color="#CC99CD">它的功能是调用该promise对象通过then指定的onRejected函数，并将错误（Error）对象传递给这个onRejected函数</font></p> <h3 id="_3-promise-then"><a href="#_3-promise-then" class="header-anchor">#</a> 3. Promise.then</h3> <p><font color="#1E90FF"><strong>① 回调函数异步执行</strong></font></p> <p>我们先来看一段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;inner promise&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;outer promise&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre></div><p>按照我们之前对<code>Promise</code>的理解，当我们看到<code>Promise</code>对象立刻进入<code>resolve</code>状态，是不是就会触发<code>Promise.then</code>中方法执行呢？答案是肯定的，但是要注意：<font color="#CC99CD">.then中指定的方法调用是异步执行的</font>，换句话说状态的改变是异步的触发<code>Promise.then</code>当中的函数执行的。这个并不是什么新鲜的知识点，你可以回去看，我们当初是把<code>Promise.then</code>方法归类到了微任务，而不是<code>Promise</code>本身或者<code>Promise</code>的其他方法。</p> <p>至于为什么<code>Promise</code>在异步回调函数当中统一采用异步调用的原因，其实是来自实践的结果，在过去大量的实践中发现如果是同步调用，代码书写的位置和顺序会和预期不符，还会导致栈溢出或者异常处理错乱等问题，所以在<code>Promise/A+</code>统一规定：<font color="#CC99CD">Promise只能使用异步调用方式</font></p> <p><font color="#1E90FF"><strong>② 返回值</strong></font></p> <p>不管你在回调函数<code>onFulfilled</code>中会返回一个什么样的值,或者不返回值，该值都会由<code>Promise.resolve(return的返回值)</code>进行相应的包装处理，因此，<font color="#CC99CD">最终then的结果都是返回一个新创建的promise对象</font></p> <p>也就是说，<font color="#3eaf7c">Promise.then不仅仅是注册一个回调函数那么简单，它还会将回调函数的返回值进行变换，创建并返回一个promise对象</font>。正是<code>then</code>函数中有了这样返回值的机制，才能使得在整个<code>Promise</code>链式结构当中，每个<code>then</code>方法都能给下一个<code>then</code>方法传递参数。现在我们怎么知道返回的<code>Promise</code>是之前的还是新的？另外该<code>Promise</code>的状态又是如何？</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> aPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> thenPromise <span class="token operator">=</span> aPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> catchPromise <span class="token operator">=</span> thenPromise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aPromise <span class="token operator">!==</span> thenPromise<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thenPromise <span class="token operator">!==</span> catchPromise<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// =&gt; true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aPromise<span class="token punctuation">,</span> thenPromise<span class="token punctuation">,</span> catchPromise<span class="token punctuation">)</span> <span class="token comment">// Promise { 100 } Promise { &lt;pending&gt; } Promise { &lt;pending&gt; }</span>
</code></pre></div><p>从上面的结果来看，<font color="#CC99CD">实际上不管是then还是catch方法调用，都返回了一个新的promise对象。</font></p> <p><font color="#1E90FF"><strong>③ promise穿透</strong></font></p> <p>我们先来举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果你认为输出的是 bar，那么你就错了。实际上它输出的是 foo！</p> <p>产生这样的输出是因为你给<code>then</code>方法传递了一个非函数（比如<code>promise</code>对象）的值，代码会这样理解：<code>then(null)</code>，因此导致前一个<code>promise</code>的结果产生了坠落的效果,也就是和下面的代码是一样的，代码直接穿透了<code>then(null)</code>进入了下一层链：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>随便添加任意多个<code>then(null)</code>，结果都是不变的</p> <h3 id="_4-promise-catch"><a href="#_4-promise-catch" class="header-anchor">#</a> 4. Promise.catch</h3> <p><font color="#1E90FF"><strong>① 语法糖的本质</strong></font></p> <p>这里我们再说一遍，实际上<code>Promise.catch</code>只是<code>promise.then(undefined, onRejected)</code>方法的一个别名而已。 也就是说，这个方法用来注册当<code>Promise</code>对象状态变为<code>Rejected</code>时的回调函数。可以看下面代码，两者写法是等价的，但是很明显<code>Promise.catch</code>会让人第一眼看上去不会眼花缭乱：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 第一种写法</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> data <span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 第二种写法</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> data <span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span> <span class="token punctuation">)</span> 
</code></pre></div><p>那么现在我们来说说为啥推荐使用第二种写法而不是第一种：</p> <ul><li>使用<code>promise.then(onFulfilled, onRejected)</code>的话,在<code>onFulfilled</code>中发生异常的话，<code>onRejected</code>中是捕获不到这个异常的。而且如果链很长的情况，每一条链上都要这样写。</li> <li>在<code>promise.then(onFulfilled).catch(onRejected)</code>的情况下<code>then</code>中产生的异常能在<code>.catch</code>中捕获。<code>.then</code>和<code>.catch</code>在本质上是没有区别的，需要分场合使用。</li></ul> <p><font color="#1E90FF"><strong>② 只有一个主人</strong></font></p> <p>我们上面已经说过了，在书写很长的<code>Promise</code>链式，从代码清晰度和简易程度来讲，在最后添加<code>catch</code>是远远比在每一层链上写<code>onRejected</code>回调函数是要好的，因为<code>catch</code>函数可以捕获<code>Promise</code>链中每一层节点中的错误，这句话本身没有错，但从这句话延伸出一种错误的理解：<code>catch</code>同时监控着所有节点。实际上<font color="#CC99CD">catch函数在同一个时间点只属于某一个Promise，因为它的主人是随着程序的执行而不断变化的</font>，我们来举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 第一层具体执行逻辑</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>           <span class="token comment">// Promise(1)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// 第二层具体执行逻辑</span>
  <span class="token keyword">return</span> <span class="token number">2</span>             <span class="token comment">// Promise(2)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// 第三层具体执行逻辑</span>
  <span class="token keyword">return</span> <span class="token number">3</span>             <span class="token comment">// Promise(3)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在上述例子中，如果整个程序是每一步都正确执行，那么会顺序产生3个<code>Promise</code>对象，分别是<code>Promise(1)</code>，<code>Promise(2)</code>，<code>Promise(3)</code>：</p> <ul><li>可是如果在第一层具体执行逻辑出错了后，那实际上后面的两个<code>then</code>中的回调函数压根不会被异步触发执行，所以直接会异步触发<code>catch</code>中的回调函数执行，所以这种情况下<code>catch</code>是<code>Promise(1)</code>对象的<code>catch</code>。</li> <li>如果第一层具体执行逻辑正确执行，就会异步触发第二个<code>then</code>中的回调函数执行，那么同理，在第二层具体执行逻辑抛错，会导致<code>Promise(2)</code>的状态变化，异步触发<code>catch</code>中的回调函数执行，所以这种情况下<code>catch</code>是<code>Promise(2)</code>对象的<code>catch</code>。</li> <li>同理<code>Promise(3)</code>也是如此。</li></ul> <p>总结下来就是： <font color="#3eaf7c">整个Promise链中，catch只属于异步触发它当中回调函数执行的那个Promise，并不属于所有Promise</font></p> <h3 id="_5-promise-all"><a href="#_5-promise-all" class="header-anchor">#</a> 5. Promise.all</h3> <p><code>Promise.all</code>接收一个<code>promise</code>对象的数组作为参数，当这个数组里的所有<code>promise</code>对象全部变为<code>resolve</code>或<code>reject</code>状态的时候，它才会去调用<code>.then</code>方法。</p> <p>传递给<code>Promise.all</code>的<code>promise</code>并不是一个个的顺序执行的，而是同时开始、并行执行的,我们可以举个例子:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> promiseArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> newPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  promiseArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newPromise<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promiseArr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>为什么从这个例子能看出数组当中的<code>Promise</code>是并行的？因为所有<code>Promise</code>执行完只用了7秒，如果4个<code>Promise</code>是按顺序执行的，那么应该是16秒，或者在7-16之间，因为4个<code>Promise</code>并不是同时执行的，同时执行的话总时间就是那个花费时间最长的<code>Promise</code></p> <p>当然还有一个很重要的点，就是如果所有的<code>Promise</code>中只有一个执行错误，那么整个<code>Promise.all</code>不会走<code>Promise.all().then()</code>这个流程了，而是走<code>Promise.all().catch()</code>这个流程，但是要注意的是<font color="#3eaf7c">虽然走到了Promise.all().catch()这个流程，但是不影响其他Promise的正常执行</font></p> <h3 id="_6-promise-race"><a href="#_6-promise-race" class="header-anchor">#</a> 6. Promise.race</h3> <p><code>Promise.race</code>的使用方法和<code>Promise.all</code>一样，接收一个<code>promise</code>对象数组为参数。<code>Promise.race</code> 只要有一个promise对象进入<code>FulFilled</code>或者<code>Rejected</code>状态的话，就会继续进行后面的处理。这里依旧有两个点要注意：</p> <ul><li>和<code>Promise.all</code>一样是所有数组当中的<code>Promise</code>是同时并行的</li> <li><code>Promise.race</code>在第一个<code>promise</code>对象变为<code>Fulfilled</code>之后，并不会取消其他<code>promise</code>对象的执行
下面我们来举个例子：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token number">7000</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> promiseArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> newPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'第二个错误'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  promiseArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newPromise<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span>promiseArr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 控制台报错</span>
<span class="token comment">// 3000</span>
<span class="token comment">// 5000</span>
<span class="token comment">// 7000</span>
</code></pre></div><p>这里我们再复习一下<code>Node</code>当中事件循环的知识：</p> <ul><li>第一层循环：i为0的时候异步触发了<code>Promise.race().catch()</code>，这里面的回调代码被放在了微队列当中，后面的3个<code>setTimeout</code>宏任务的回调函数代码被放在了<code>timer</code>阶段中的队列当中（其实并不是这样，因为3个定时器都有延迟，都是在后面的事件循环中添加进来的）</li> <li>第二层循环：清空微任务队列，所以控制台打印出了错误，然后清空宏任务，分别打印出3000，5000，7000</li></ul> <h2 id="错误捕获"><a href="#错误捕获" class="header-anchor">#</a> 错误捕获</h2> <h3 id="_1-使用reject而不是throw"><a href="#_1-使用reject而不是throw" class="header-anchor">#</a> 1. 使用reject而不是throw</h3> <p>在最开始我们先来一句比较重要的话：<font color="#CC99CD">Promise的构造函数，以及被then调用执行的函数基本上都可以认为是在 try...catch 代码块中执行的，所以在这些代码中即使使用throw ，程序本身也不会因为异常而终止。</font></p> <p>所以其实如果在<code>Promise</code>中使用<code>throw</code>语句的话，会被<code>try...catch</code>住，最终<code>promise</code>对象也变为<code>Rejected</code>状态。但是我们为什么还是推荐使用<code>Promise.reject</code>呢？有下面俩个原因：</p> <ul><li><font color="#1E90FF">我们很难区分throw 是我们主动抛出来的，还是因为真正的其它异常导致的</font></li> <li><font color="#1E90FF">Promise构造函数当中通过throw抛出的错误未必会被Promise.catch捕获到</font></li></ul> <p>我们下面就说说什么时候通过throw抛出的错误未必会被Promise.catch捕获到：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'async error'</span><span class="token punctuation">)</span>   
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'程序正常执行了'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到错误了'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 直接报错</span>
</code></pre></div><p>这个例子非常典型，想知道为什么错误没有被catch住，我们要倒推出原因：</p> <ul><li>首先我们要明确的是，<font color="#3eaf7c">不论是then还是catch中注册的回调函数，都是由Promise状态的变化触发的</font>，现在也就说<code>Promise</code>状态始终在<code>pending</code>状态</li> <li>其次，前面不是说<code>reject</code>和<code>throw</code>都能最终让<code>Promise</code>进入<code>onReject</code>状态么，这里的<code>throw</code>为什么没有改变<code>Promise</code>的状态</li> <li>原因还是要从事件循环来说，我们好好想想，这段代码在第一轮的事件循环当中<code>setTimeout</code>的回调函数被放在了<code>timer</code>阶段的队列当中，但是它没有执行啊，所以第一轮<code>Promise</code>状态一直处于<code>pending</code>，所以<code>then</code>和<code>catch</code>部分的代码全部没有被触发，也就在第一轮事件循环当中跳过了。然后在第二轮循环当中才执行了<code>throw</code>语句，把错误直接抛到了全局，就直接报错。所以上面的代码和下面的效果一样，<code>catch</code>怎么可能捕获到在它后面执行的代码呢？</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'async error'</span><span class="token punctuation">)</span>   
</code></pre></div><h3 id="_2-在then中进行reject"><a href="#_2-在then中进行reject" class="header-anchor">#</a> 2. 在then中进行reject</h3> <p>如果我们想在<code>then</code>当中使用<code>reject</code>,首先我们要懂两个知识点：</p> <ul><li><code>then</code>中的回调函数中，<code>return</code>的返回值类型不光是简单的字面值，还可以是复杂的对象类型，比如<code>promise</code>对象等</li> <li>只要修改这个返回的<code>Promise</code>的状态，在下一个<code>then</code>中注册的回调函数中的<code>onFulfilled</code>和<code>onRejected</code>的哪一个会被调用也是能确定的</li></ul> <p>所以我们可以这样写代码就能在<code>then</code>当中使用<code>reject</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> onRejected <span class="token operator">=</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>console<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> retPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;this promise is rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> retPromise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当然还能更简洁一些：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;this promise is rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="返回值"><a href="#返回值" class="header-anchor">#</a> 返回值</h2> <p>关于返回值的知识其实我们在前面都已经讲过，这里总结一下并举个例子巩固一下：</p> <ul><li><font color="#3eaf7c">Promise会将最后的值存储起来，如果在下次使用promise方法的时候回直接返回该值的promise。</font></li> <li><font color="#3eaf7c">Promise能够链式调用的原因是它的每一个方法都返回新的promise，哪怕是finally方法，特殊的是finlly会返回上一个promise的值包装成的新promise，并且finally也不接收参数，因为无论Promise是reject还是fulfill它都会被调用。</font></li></ul> <p>下面我们举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token comment">// 先打印出1</span>
<span class="token comment">// 一秒之后打印出2</span>
</code></pre></div><p>这个例子也很经典，即使你已经搞清楚了上面的知识点，面对这个例子也还是会蒙掉，我们来说一下：</p> <ul><li>首先通过构造函数创建了一个<code>Promise</code>,我们这里称之为<code>Promise_1</code>,通过<code>reject</code>进入<code>catch</code>函数，然后注意，<code>catch</code>的回调函数返回了一个2，实际上这里是返回了一个新的<code>Promise</code>,我们这里称<code>Promise_2</code>，它的状态是<code>fulfilled</code>。</li> <li>所以这里很迷惑人的一点就是<code>p1</code>最开始是指向<code>Promise_1</code>的，当<code>Promise_2</code>返回的时候，它又指向了<code>Promise_2</code></li> <li>最后定时器经过一秒打印出2，因为<code>Promise_2</code>在被返回的时候就是<code>fulfilled</code>状态，<code>then</code>函数当中的回调函数自然而然的被异步触发。</li></ul> <p><strong>参考资料</strong></p> <ol><li><a href="https://juejin.im/entry/58650a7a128fe1006d132b80" target="_blank" rel="noopener noreferrer">JS 异步工具之 --Promise <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://liubin.org/promises-book/" target="_blank" rel="noopener noreferrer">JavaScript Promise迷你书（中文版）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5c233a8ee51d450d5a01b712" target="_blank" rel="noopener noreferrer">面试官眼中的Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://efe.baidu.com/blog/promises-anti-pattern/" target="_blank" rel="noopener noreferrer">谈谈使用 promise 时候的一些反模式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/entry/5844c8e461ff4b006b9e2ebd" target="_blank" rel="noopener noreferrer">深入理解 Promise (上)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5b854f22e51d4538e567b7de" target="_blank" rel="noopener noreferrer">从手写一个符合Promise/A+规范Promise来深入学习Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5a59e78ff265da3e3e33ba6e" target="_blank" rel="noopener noreferrer">Promise深度学习---我のPromise/A+实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/entry/58a10aa61b69e60059d1d2af" target="_blank" rel="noopener noreferrer">深入 Promise(一)——Promise 实现详解 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/15/2020, 6:32:10 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/node/three_asyncPreliminary.html" class="prev">异步流程初探</a></span> <span class="next"><a href="/node/three_asyncDepth_promise2.html">Promise实现详解</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.5b8afd62.js" defer></script><script src="/assets/js/2.26f2bd2e.js" defer></script><script src="/assets/js/127.e9ad96e9.js" defer></script>
  </body>
</html>
